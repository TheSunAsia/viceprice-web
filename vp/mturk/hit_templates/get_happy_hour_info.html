
<script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css" property="stylesheet" rel="stylesheet" />
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css" property="stylesheet" rel="stylesheet" />

<style>
    .hidden {
        display: none;
        width: 0;
        height: 0;
    }

    .instructions-header {
        margin-bottom: 1rem;
        font-size: 18px;
        font-weight: bold;
    }

    .instructions-content {
        font-size: 16px;
    }

    .happy-hour-entry-container {
        margin-top: 3rem;
        font-size: 14px;
    }

    .happy-hour-entry-container h6 {
        margin-bottom: 0;
    }

    .happy-hour-entry-container a {
        cursor: pointer;
    }

    .happy-hour-entry-container input, .happy-hour-entry-container select {
        font-size: 14px;
    }

    .title-row {
        margin-bottom: 8px;
    }

    .content-row {
        margin-bottom: 16px;
    }

    .start-time, .end-time {
        width: 24%;
    }

    .deal-value {
        width: 50%;
    }

    .drink-names {
        width: 92%;
    }

    i.fa.fa-minus-circle {
        color: red;
        cursor: pointer;
        font-size: 18px;
        padding: 3px;
    }
</style>

<div class="container happy-hour-entry-container">
    <div class="instructions-section">
        <div class="instructions-header">Instructions Here</div>
        <div class="instructions-content">LOCATION: ${location-name}</div>
        <div class="instructions-content">WEBSITE: ${location-website}</div>
    </div>
    <div class="deal-section">
        <hr/>
        <div><i class="fa fa-minus-circle delete-deal-link"></i></div>
        <div class="row title-row">
            <div class="seven columns">
                <h6>DAY(S) OF WEEK (Click and drag to select)</h6>
            </div>
            <div class="five columns">
                <h6>TIME PERIOD</h6>
            </div>
        </div>
        <div class="row content-row">
            <div class="seven columns day-of-week-buttons">
                <button class="monday-button">M</button>
                <button class="tuesday-button">T</button>
                <button class="wednesday-button">W</button>
                <button class="thursday-button">Th</button>
                <button class="friday-button">F</button>
                <button class="saturday-button">S</button>
                <button class="sunday-button">Su</button>
            </div>
            <div class="five columns time-periods">
                <div class="first-time-period">
                    <input type="text" class="start-time" placeholder="00:00 AM"/>
                    <span> to </span>
                    <input type="text" class="end-time" placeholder="00:00 AM"/>
                    <input type="checkbox" class="until-close"/>
                    <span>Til Close</span>
                </div>

                <div>
                    <a class="add-time-period-link"> + Add another time period</a>
                </div>

                <div class="second-time-period hidden">
                    <i class="fa fa-minus-circle delete-time-period-link"></i>
                    <input type="text" class="start-time" placeholder="00:00 AM"/>
                    <span> to </span>
                    <input type="text" class="end-time" placeholder="00:00 AM"/>
                    <input type="checkbox" class="until-close"/>
                    <span>Til Close</span>
                </div>
            </div>
        </div>
        <div class="row title-row">
            <div class="six columns">
                <h6>DRINK NAMES</h6>
            </div>
            <div class="two columns">
                <h6>CATEGORY</h6>
            </div>
            <div class="two columns">
                <h6>DEAL TYPE</h6>
            </div>
            <div class="two columns">
                <h6>DEAL VALUE</h6>
            </div>
        </div>
        <div class="deal-detail-section">
            <div class="row content-row">
                <div class="six columns">
                    <i class="fa fa-minus-circle delete-deal-detail-link"></i>
                    <input type="text" class="u-full-width drink-names" placeholder="Corona Light, Miller Lite"/>
                </div>
                <div class="two columns">
                    <select class="u-full-width drink-category">
                        <option value="beer">Beer</option>
                        <option value="wine">Wine</option>
                        <option value="liquor">Liquor</option>
                    </select>
                </div>
                <div class="two columns">
                    <select class="u-full-width deal-type">
                        <option value="price">Price</option>
                        <option value="percent-off">% Off</option>
                        <option value="price-off">$ Off</option>
                    </select>
                </div>
                <div class="two columns">
                    <span class="dollar-prefix">$</span>
                    <input type="text" class="deal-value"/>
                    <span class="percent-off-suffix hidden">% off</span>
                    <span class="price-off-suffix hidden"> off</span>
                </div>
            </div>
        </div>
        <div>
            <a class="add-deal-detail-link"> + Add another drink special [For the same day]</a>
        </div>
    </div>
    <div class="row">
        <a class="add-deal-link"> + Add day [Drink special is at another time]</a>
    </div>
</div>

<script type="text/javascript">
    var isMouseDown = false;
    var happyHourBodyHTML = "";
    var dealTemplateHTML = "";
    var dealDetailTemplateHTML = "";
    var locationID;

    $(document).ready(function() {

        dealTemplateHTML = $(".deal-section").html();
        dealDetailTemplateHTML = $(".deal-detail-section").html();
        happyHourBodyHTML = $(".happy-hour-entry-container").html();

        // Track mouse up for day of week selection
        $(document)
        .mouseup(function() {
            isMouseDown = false;
        });
    });

    $(document).on("mousedown", ".day-of-week-buttons button", function() {
        isMouseDown = true;
        $(this).toggleClass("button-primary");
        return false;
    });

    $(document).on("mouseover", ".day-of-week-buttons button", function() {
        if (isMouseDown) {
            $(this).toggleClass("button-primary");
        }
    });

    $(document).on("change", ".until-close", function() {
        if (this.checked) {
            $(this).prev().prop("disabled", true).val("--");
        } else {
            $(this).prev().prop("disabled", false).val("");
        }
    });

    $(document).on("click", ".add-time-period-link", function() {
        $(this).parent().parent().find(".second-time-period").removeClass("hidden");
        $(this).addClass("hidden");
    });

    $(document).on("click", ".delete-time-period-link", function() {
        $(this).parent().parent().find(".add-time-period-link").removeClass("hidden");
        $(this).parent().addClass("hidden");
    });

    $(document).on("change", ".deal-type", function() {
        if ($(this).val() == "price") {
            $(this).parent().parent().find(".dollar-prefix").removeClass("hidden");
            $(this).parent().parent().find(".percent-off-suffix").addClass("hidden");
            $(this).parent().parent().find(".price-off-suffix").addClass("hidden");
        }
        else if ($(this).val() == "percent-off") {
            $(this).parent().parent().find(".dollar-prefix").addClass("hidden");
            $(this).parent().parent().find(".percent-off-suffix").removeClass("hidden");
            $(this).parent().parent().find(".price-off-suffix").addClass("hidden");
        }
        else if ($(this).val() == "price-off") {
            $(this).parent().parent().find(".dollar-prefix").removeClass("hidden");
            $(this).parent().parent().find(".percent-off-suffix").addClass("hidden");
            $(this).parent().parent().find(".price-off-suffix").removeClass("hidden");
        }
    });

    $(document).on("click", ".add-deal-detail-link", function() {
        $(this).parent().before("<div class='deal-detail-section'>" + dealDetailTemplateHTML + "</div>");
    });

    $(document).on("click", ".delete-deal-detail-link", function() {
        if ($(".delete-deal-detail-link").length > 1) {
            $(this).parent().parent().remove();
        }
    })

    $(document).on("click", ".add-deal-link", function(event) {
        $(this).parent().before("<div class='deal-section'>" + dealTemplateHTML + "</div>");
    });

    $(document).on("click", ".delete-deal-link", function(event) {
        if ($(".delete-deal-link").length > 1) {
            $(this).parent().parent().remove();
        }
    });

    $(document).on("click", "#requires-phone", function(event) {
        get_location_that_needs_happy_hour();
    });

    var getDealInfo = function(dealElement) {
        var daysOfWeek = getDaysOfWeek(dealElement.find(".day-of-week-buttons .button-primary"));
        var timePeriods = getTimePeriods(dealElement.find(".time-periods"));
        var dealDetails = getDealDetails(dealElement);

        return {
            "daysOfWeek": daysOfWeek,
            "timePeriods": timePeriods,
            "dealDetails": dealDetails
        }
    };

    var getTimePeriods = function(timePeriods) {
        var firstTimePeriod = {
            'startTime': timePeriods.find(".first-time-period .start-time").val(),
            'endTime': timePeriods.find(".first-time-period .end-time").val(),
            'untilClose': timePeriods.find(".first-time-period .until-close").is(":checked")
        };
        var timePeriodResults = [firstTimePeriod];

        if (timePeriods.find(".second-time-period").not(".hidden").length == 1) {
            var secondTimePeriod = {
                'startTime': timePeriods.find(".second-time-period .start-time").val(),
                'endTime': timePeriods.find(".second-time-period .end-time").val(),
                'untilClose': timePeriods.find(".second-time-period .until-close").is(":checked")
            };
            timePeriodResults.push(secondTimePeriod);
        }

        return timePeriodResults;
    };

    var getDealDetails = function(dealElement) {
        var dealDetails = dealElement.find(".deal-detail-section");
        var dealDetailResults = [];

        for (var i = 0; i < dealDetails.length; i++) {
            var detail = $(dealDetails[i]);
            dealDetailResults.push({
                'names': detail.find(".drink-names").val(),
                'category': detail.find(".drink-category").val(),
                'dealType': detail.find(".deal-type").val(),
                'dealValue': parseFloat(detail.find(".deal-value").val())
            });
        }

        return dealDetailResults;
    };

    var getDaysOfWeek = function(daysOfWeekPrimaryButtons) {
        var days = [];
        for (var i = 0; i < daysOfWeekPrimaryButtons.length; i++) {
            var button = daysOfWeekPrimaryButtons[i];
            if ($(button).hasClass("monday-button")) {
                days.push(1);
                continue;
            }
            if ($(button).hasClass("tuesday-button")) {
                days.push(2);
                continue;
            }
            if ($(button).hasClass("wednesday-button")) {
                days.push(3);
                continue;
            }
            if ($(button).hasClass("thursday-button")) {
                days.push(4);
                continue;
            }
            if ($(button).hasClass("friday-button")) {
                days.push(5);
                continue;
            }
            if ($(button).hasClass("saturday-button")) {
                days.push(6);
                continue;
            }
            if ($(button).hasClass("sunday-button")) {
                days.push(7);
            }
        }
        return days;
    };

    var clear_inputs = function(data) {
        $(".happy-hour-entry-container").html(happyHourBodyHTML);
    };
</script>