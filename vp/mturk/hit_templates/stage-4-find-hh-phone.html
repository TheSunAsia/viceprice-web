<!-- JQuery 1.11.2 -->
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<!-- Bootstrap v3.0.3 -->
<link href="https://s3.amazonaws.com/mturk-public/bs30/css/bootstrap.min.css" property="stylesheet" rel="stylesheet" />

<style type="text/css">
    .container {
        font-family: Tahoma;
        font-size: 14px;
        line-height: 28px;
    }
    p {
        line-height: 1.4;
    }
    .bold-text {
        font-weight: bold;
    }
    .inline {
        display: inline;
    }
    .indent-1 {
        padding-left: 20px;
    }
    .indent-2 {
        padding-left: 40px;
    }
    .radio.indent-1 {
        padding-left: 40px;
    }
    .question {
        margin-bottom: 10px;
    }
    a.expand-collapse-link {
        float: right;
        color: white;
    }
    .example-container {
        margin-bottom: 20px;
    }
    .hh-info-example-table {
        width: 800px;
        padding: 20px;
        font-family: Verdana, Geneva, sans-serif;
        font-size: 11.7px;
        color: grey;
    }
    .hh-info-example-table td {
        border: 1px solid grey;
        text-align: left;
        vertical-align: top;
        padding: 10px;
    }
    .hh-info-table {
        width: 800px;
        padding: 20px;
        font-family: Verdana, Geneva, sans-serif;
        font-size: 11.7px;
    }
    .hh-info-table td {
        border: 1px solid black;
        text-align: left;
        vertical-align: top;
        padding: 10px;
    }
    .hh-info-table td input {
        width: 100px;
    }
    .narrow-column {
        width: 120px;
    }
    .wide-column {
        width: 440px;
    }
    textarea {
        resize: none;
        overflow: hidden;
        width: 420px;
        max-height: 1000px;
    }
</style>
<section class="container" id="Survey">
    <div class="panel panel-primary">
        <div class="panel-heading">
            <div class="bold-text inline">Instructions</div>
            <a class="expand-collapse-link expanded">[Hide]</a>
        </div>
        <div class="panel-body">
            <div class="collapsible">
                <div>
                    You will call a business and ask what their Happy Hour specials are.
                </div>
            	<div class="bold-text">
                    Happy Hours are when alcoholic drinks [beer/wine/liquor] are cheaper at a specific time and/or day.
                </div>

                <div>
                    A bonus is given to calls that get Happy Hour information.
                    If your call did not go through, you will only get the base rate and no bonus.
                    We quality check all our info.
                    <span class="bold-text">
                        If you are caught lying you will be given a ban.
                    </span>
                </div>
            </div>
        </div>
    </div>



    <div class="question">
        <div>
            <div>
                Your goal is to call for Happy Hour info and enter that info into a table like this one.
                Please retrieve both a time and description for all deals.
            </div>
            <div class="example-container">
                <table class="hh-info-example-table">
                    <tbody>
                        <tr>
                            <td class="narrow-column"><strong>Day</strong></td>
                            <td class="narrow-column"><strong>Happy Hour Start Time</strong></td>
                            <td class="narrow-column"><strong>Happy Hour End Time</strong></td>
                            <td class="wide-column"><strong>Happy Hour Description</strong></td>
                        </tr>
                        <tr>
                            <td>Monday</td>
                            <td>03:00 PM</td>
                            <td>07:00 PM</td>
                            <td>$3 Drafts of Stoney&rsquo;s Amber, Shocktop<br />
                            $5 Specialty Cocktail<br />
                            $4 House Red or White Wine</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <span class="bold-text">
                Call *67 ${phone_number} [*67 hides your number from the caller ID] and ask for their Happy Hour specials.
                Were you able to reach ${name} and get their Happy Hour specials?
            </span>
        </div>

        <div class="radio indent-1">
            <label>
                <input name="happy-hour-found" type="radio" value="yes" />
                <span>Yes, happy hour information received</span>
            </label>
        </div>

        <div class="radio indent-1">
            <label>
                <input name="happy-hour-found" type="radio" value="no" />
                <span>${name} has no happy hours</span>
            </label>
        </div>

        <div class="radio indent-1">
            <label>
                <input name="happy-hour-found" type="radio" value="no-response" />
                <span>No one picked up my call</span>
            </label>
        </div>

        <div class="radio indent-1">
            <label>
                <input name="happy-hour-found" type="radio" value="wrong-phone-number" />
                <span>This is the wrong phone number for ${name}</span>
            </label>
        </div>
    </div>

    <div class="question show-if-hh-found">
        <div class="bold-text">
            Enter the Happy Hour time and deal description. Rules for the deal description:
        </div>
        <ol>
            <li>
                No food. We only want alcoholic drinks.
            </li>
            <li>
                No ingredients. Only copy the drink name, not what is in the drink.
            </li>
            <li>
                Do not copy where a drink came from. Only the name.
            </li>
        </ol>
        <div>Here is an example of how to format your response:</div>
    </div>
    <div class="question show-if-hh-found">

        <div>
            <table class="hh-info-table">
            	<tbody>
            		<tr>
            			<td class="narrow-column"><strong>Day</strong></td>
            			<td class="narrow-column"><strong>Happy Hour Start Time</strong></td>
            			<td class="narrow-column"><strong>Happy Hour End Time</strong></td>
            			<td class="wide-column"><strong>Happy Hour Description</strong></td>
            		</tr>
            		<tr>
            			<td>Monday</td>
            			<td><input name="monday-start-time" type="text" placeholder="00:00 AM"/></td>
            			<td><input name="monday-end-time" type="text" placeholder="00:00 AM"/></td>
            			<td><textarea name="monday-description" onkeyup="auto_grow(this)"></textarea></td>
            		</tr>
            		<tr>
            			<td>Tuesday</td>
            			<td><input name="tuesday-start-time" type="text" placeholder="00:00 AM"/></td>
            			<td><input name="tuesday-end-time" type="text" placeholder="00:00 AM"/></td>
            			<td><textarea name="tuesday-description" onkeyup="auto_grow(this)"></textarea></td>
            		</tr>
            		<tr>
            			<td>Wednesday</td>
            			<td><input name="wednesday-start-time" type="text" placeholder="00:00 AM"/></td>
            			<td><input name="wednesday-end-time" type="text" placeholder="00:00 AM"/></td>
            			<td><textarea name="wednesday-description" onkeyup="auto_grow(this)"></textarea></td>
            		</tr>
            		<tr>
            			<td>Thursday</td>
            			<td><input name="thursday-start-time" type="text" placeholder="00:00 AM"/></td>
            			<td><input name="thursday-end-time" type="text" placeholder="00:00 AM"/></td>
            			<td><textarea name="thursday-description" onkeyup="auto_grow(this)"></textarea></td>
            		</tr>
            		<tr>
            			<td>Friday</td>
            			<td><input name="friday-start-time" type="text" placeholder="00:00 AM"/></td>
            			<td><input name="friday-end-time" type="text" placeholder="00:00 AM"/></td>
            			<td><textarea name="friday-description" onkeyup="auto_grow(this)"></textarea></td>
            		</tr>
            		<tr>
            			<td>Saturday</td>
            			<td><input name="saturday-start-time" type="text" placeholder="00:00 AM"/></td>
            			<td><input name="saturday-end-time" type="text" placeholder="00:00 AM"/></td>
            			<td><textarea name="saturday-description" onkeyup="auto_grow(this)"></textarea></td>
            		</tr>
            		<tr>
            			<td>Sunday</td>
            			<td><input name="sunday-start-time" type="text" placeholder="00:00 AM"/></td>
            			<td><input name="sunday-end-time" type="text" placeholder="00:00 AM"/></td>
            			<td><textarea name="sunday-description" onkeyup="auto_grow(this)"></textarea></td>
            		</tr>
            	</tbody>
            </table>
        </div>
    </div>

    <div class="question">
        <div class="bold-text">
            Have any comments?
        <div>
        <div>
            <input class="form-control" name="comments" placeholder="" type="text" />
        </div>
    </div>

    <!-- // Format: ***1|||16:00|||19:00|||Description***2... -->
    <input name="deals" type="hidden" value=""/>
</section>

<script type="text/javascript">
    // Expand and collapse instructions
    $(".expand-collapse-link").click(function() {
        if ($(this).hasClass("expanded")) {
            $(this).text("[Show]");
            $(this).removeClass("expanded");
            $(".collapsible").hide();
        } else {
            $(this).text("[Hide]");
            $(this).addClass("expanded");
            $(".collapsible").show();
        }
    });

    // Expand happy hours section only if happy hours were found.
    // Preset the value to happy hours found to show table
    $("input[name='happy-hour-found'][value='yes']").prop("checked", true);
    $("input[name='happy-hour-found']").change(function() {
        if ($(this).val() == "yes") {
            $(".show-if-hh-found").show();
        } else {
            $(".show-if-hh-found").hide();
        }
    });

    // Try to parse time to 24 hour HH:MM format, return null on failure
    // http://www.timlabonne.com/2013/07/parsing-a-time-string-with-javascript/
    var parse_time = function(timeStr) {
        timeStr = timeStr.trim();
        var time = timeStr.match(/(\d+)(?::(\d\d))?\s*(p?)/i);

        // Ensure that there are 2 minute digits
        var colonIndex = timeStr.indexOf(":");
        if (colonIndex > -1) {
            if (isNaN(parseInt(timeStr[colonIndex + 1]))
                || isNaN(parseInt(timeStr[colonIndex + 2]))) {
                return null;
            }
            if (colonIndex > 2) {
                return null;
            }
            if (!isNaN(parseInt(timeStr[colonIndex + 3]))) {
                return null;
            }
        } else {
            if (timeStr == "0") {
                return null;
            }
        }

        if (!time) {
            return null;
        }

        var hour = parseInt(time[1], 10);
        var minute = parseInt(time[2], 10);
        if (minute < 0 || minute > 59) {
            return null;
        }

        if (isNaN(minute)) {
            minute = 0;
        }

        if ((time[3] === "p" || time[3] === "P") && hour !== 12) {
            hour += 12;
        }
        if (hour < 0 || hour > 23) {
            return null;
        }

        if (timeStr[timeStr.length - 1] !== 'm' &&
            timeStr[timeStr.length - 1] !== 'M' &&
            timeStr[timeStr.length - 1] !== '.' &&
            hour <= 12
            && hour > 0) {
            return null;
        }

        if (time[3].length === 0 && hour === 12) {
            hour = 0;
        }

        var formattedHour = "" + hour;
        if (formattedHour.length === 1) {
            formattedHour = "0" + hour;
        }
        var formattedMinute = "" + minute;
        if (formattedMinute.length === 1) {
            formattedMinute = "0" + minute;
        }

        return formattedHour + ":" + formattedMinute;
    };

    // Auto-grow textareas on front end
    var auto_grow = function(element) {
        element.style.height = "5px";
        element.style.height = (element.scrollHeight) + "px";
    };

    $(document).ready(function() {
      $('#submitButton').click(function() {
        // Check whether happy hour found is checked
        if (!$("input[name='happy-hour-found']:checked").val()) {
            alert('Please select whether or not you found a happy hour.');
            return false;
        }

        if ($("input[name='happy-hour-found']:checked").val() == "yes") {

            // Check that times and descriptions are populated correctly
            var mondayStartTime = $("input[name='monday-start-time']").val();
            var mondayEndTime = $("input[name='monday-end-time']").val();
            var mondayDescription = $("textarea[name='monday-description']").val();
            var tuesdayStartTime = $("input[name='tuesday-start-time']").val();
            var tuesdayEndTime = $("input[name='tuesday-end-time']").val();
            var tuesdayDescription = $("textarea[name='tuesday-description']").val();
            var wednesdayStartTime = $("input[name='wednesday-start-time']").val();
            var wednesdayEndTime = $("input[name='wednesday-end-time']").val();
            var wednesdayDescription = $("textarea[name='wednesday-description']").val();
            var thursdayStartTime = $("input[name='thursday-start-time']").val();
            var thursdayEndTime = $("input[name='thursday-end-time']").val();
            var thursdayDescription = $("textarea[name='thursday-description']").val();
            var fridayStartTime = $("input[name='friday-start-time']").val();
            var fridayEndTime = $("input[name='friday-end-time']").val();
            var fridayDescription = $("textarea[name='friday-description']").val();
            var saturdayStartTime = $("input[name='saturday-start-time']").val();
            var saturdayEndTime = $("input[name='saturday-end-time']").val();
            var saturdayDescription = $("textarea[name='saturday-description']").val();
            var sundayStartTime = $("input[name='sunday-start-time']").val();
            var sundayEndTime = $("input[name='sunday-end-time']").val();
            var sundayDescription = $("textarea[name='sunday-description']").val();

            var formattedHappyHourString = "";

            if (mondayStartTime.length > 0
                || mondayEndTime.length > 0) {
                if (mondayDescription.length === 0) {
                    alert("Please populate a description for Monday's happy hour or delete the Monday times");
                    return false;
                } else {
                    var formattedMondayStartTime = parse_time(mondayStartTime);
                    var formattedMondayEndTime = parse_time(mondayEndTime);
                    if (!formattedMondayStartTime || !formattedMondayEndTime) {
                        alert("Please provide Monday times in 00:00AM format");
                        return false;
                    } else {
                        formattedHappyHourString = formattedHappyHourString +
                            "***1|||" + formattedMondayStartTime + "|||" +
                            formattedMondayEndTime + "|||" +
                            mondayDescription.trim();
                    }
                }
            }

            if (tuesdayStartTime.length > 0
                || tuesdayEndTime.length > 0) {
                if (tuesdayDescription.length === 0) {
                    alert("Please populate a description for Tuesday's happy hour or delete the Tuesday times");
                    return false;
                } else {
                    var formattedTuesdayStartTime = parse_time(tuesdayStartTime);
                    var formattedTuesdayEndTime = parse_time(tuesdayEndTime);
                    if (!formattedTuesdayStartTime || !formattedTuesdayEndTime) {
                        alert("Please provide Tuesday times in 00:00AM format");
                        return false;
                    } else {
                        formattedHappyHourString = formattedHappyHourString +
                            "***2|||" + formattedTuesdayStartTime + "|||" +
                            formattedTuesdayEndTime + "|||" +
                            tuesdayDescription.trim();
                    }
                }
            }

            if (wednesdayStartTime.length > 0
                || wednesdayEndTime.length > 0) {
                if (wednesdayDescription.length === 0) {
                    alert("Please populate a description for Wednesday's happy hour or delete the Wednesday times");
                    return false;
                } else {
                    var formattedWednesdayStartTime = parse_time(wednesdayStartTime);
                    var formattedWednesdayEndTime = parse_time(wednesdayEndTime);
                    if (!formattedWednesdayStartTime || !formattedWednesdayEndTime) {
                        alert("Please provide Wednesday times in 00:00AM format");
                        return false;
                    } else {
                        formattedHappyHourString = formattedHappyHourString +
                            "***3|||" + formattedWednesdayStartTime + "|||" +
                            formattedWednesdayEndTime + "|||" +
                            wednesdayDescription.trim();
                    }
                }
            }

            if (thursdayStartTime.length > 0
                || thursdayEndTime.length > 0) {
                if (thursdayDescription.length === 0) {
                    alert("Please populate a description for Thursday's happy hour or delete the Thursday times");
                    return false;
                } else {
                    var formattedThursdayStartTime = parse_time(thursdayStartTime);
                    var formattedThursdayEndTime = parse_time(thursdayEndTime);
                    if (!formattedThursdayStartTime || !formattedThursdayEndTime) {
                        alert("Please provide Thursday times in 00:00AM format");
                        return false;
                    } else {
                        formattedHappyHourString = formattedHappyHourString +
                            "***4|||" + formattedThursdayStartTime + "|||" +
                            formattedThursdayEndTime + "|||" +
                            thursdayDescription.trim();
                    }
                }
            }

            if (fridayStartTime.length > 0
                || fridayEndTime.length > 0) {
                if (fridayDescription.length === 0) {
                    alert("Please populate a description for Friday's happy hour or delete the Friday times");
                    return false;
                } else {
                    var formattedFridayStartTime = parse_time(fridayStartTime);
                    var formattedFridayEndTime = parse_time(fridayEndTime);
                    if (!formattedFridayStartTime || !formattedFridayEndTime) {
                        alert("Please provide Friday times in 00:00AM format");
                        return false;
                    } else {
                        formattedHappyHourString = formattedHappyHourString +
                            "***5|||" + formattedFridayStartTime + "|||" +
                            formattedFridayEndTime + "|||" +
                            fridayDescription.trim();
                    }
                }
            }

            if (saturdayStartTime.length > 0
                || saturdayEndTime.length > 0) {
                if (saturdayDescription.length === 0) {
                    alert("Please populate a description for Saturday's happy hour or delete the Saturday times");
                    return false;
                } else {
                    var formattedSaturdayStartTime = parse_time(saturdayStartTime);
                    var formattedSaturdayEndTime = parse_time(saturdayEndTime);
                    if (!formattedSaturdayStartTime || !formattedSaturdayEndTime) {
                        alert("Please provide Saturday times in 00:00AM format");
                        return false;
                    } else {
                        formattedHappyHourString = formattedHappyHourString +
                            "***6|||" + formattedSaturdayStartTime + "|||" +
                            formattedSaturdayEndTime + "|||" +
                            saturdayDescription.trim();
                    }
                }
            }

            if (sundayStartTime.length > 0
                || sundayEndTime.length > 0) {
                if (sundayDescription.length === 0) {
                    alert("Please populate a description for Sunday's happy hour or delete the Sunday times");
                    return false;
                } else {
                    var formattedSundayStartTime = parse_time(sundayStartTime);
                    var formattedSundayEndTime = parse_time(sundayEndTime);
                    if (!formattedSundayStartTime || !formattedSundayEndTime) {
                        alert("Please provide Sunday times in 00:00AM format");
                        return false;
                    } else {
                        formattedHappyHourString = formattedHappyHourString +
                            "***7|||" + formattedSundayStartTime + "|||" +
                            formattedSundayEndTime + "|||" +
                            sundayDescription.trim();
                    }
                }
            }

            if (formattedHappyHourString.length === 0) {
                alert("Please enter happy hour information or select no happy hours found");
                return false;
            }

            $("input[name='deals']").val(formattedHappyHourString);

            return confirm('Are you sure the happy hour descriptions contain NO food deals? Click Cancel to edit, OK to submit');
        } else {
            return true;
        }
      });
    });
</script>
